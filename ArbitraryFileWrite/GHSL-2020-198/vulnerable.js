// USED FOR SPOT THE VULNERABILITY
/*
class Zip {
    // ... REDACTED ...

    extractAllTo(targetPath, overwrite, pass) {
        overwrite = overwrite || false;
        this.entries.forEach(function (entry) {
            const entryName = pth.normalize(pth.join(targetPath,
                entry.entryName.toString()));
            if (entry.isDirectory) {
                Utils.makeDir(entryName);
                return;
            }
            const content = entry.getData(pass);
            if (!content) throw new Error(Utils.Errors.CANT_EXTRACT_FILE);
            Utils.writeFileTo(entryName, content, overwrite);
        })
    }
}
*/

const express = require('express');
const upload = require('multer')({dest: 'uploads/'});
const pth = require("path");
const admZip = require('adm-zip');
const app = express();

app.post('/', upload.single('file'), function(req,res) {
    let zip = new admZip(req.file.path);
    zip.extractAllTo('files/', true);
    res.send("unzipped");
});

var server = app.listen(3001, function() {
    var host = server.address().address;
    var port = server.address().port;
    console.log('Example app listening at http://%s:%s', host, port);
});
